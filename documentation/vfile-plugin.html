<!DOCTYPE html>
<head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="keywords" content=" ">
<title>vFile volume plugin for Docker | vSphere Docker Volume Service</title>
<link rel="stylesheet" href="css/syntax.css">


<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
<!--<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">-->
<link rel="stylesheet" href="css/modern-business.css">
<link rel="stylesheet" href="css/infracloudio-lavish-bootstrap.css">
<link rel="stylesheet" href="css/vmware-customstyles.css">
<link rel="stylesheet" href="css/infracloudio-theme-blue.css">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="js/jquery.navgoco.min.js"></script>


<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/2.0.0/anchor.min.js"></script>
<script src="js/toc.js"></script>
<script src="js/customscripts.js"></script>

<link rel="shortcut icon" href="images/favicon.ico">

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

<link rel="alternate" type="application/rss+xml" title="" href="feed.xml">

    <script>
        $(document).ready(function() {
            // Initialize navgoco with default options
            $("#mysidebar").navgoco({
                caretHtml: '',
                accordion: true,
                openClass: 'active', // open
                save: false, // leave false or nav highlighting doesn't work right
                cookie: {
                    name: 'navgoco',
                    expires: false,
                    path: '/'
                },
                slide: {
                    duration: 400,
                    easing: 'swing'
                }
            });

            $("#collapseAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', false);
            });

            $("#expandAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', true);
            });

        });

    </script>
    <script>
        $(function () {
            $('[data-toggle="tooltip"]').tooltip()
        })
    </script>
    

</head>
<body>
<!-- Navigation -->
<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container topnavlinks">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="fa fa-home fa-lg navbar-brand" href="index.html">&nbsp;<span class="projectTitle"> vSphere Docker Volume Service</span></a>
        </div>
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <!-- entries without drop-downs appear here -->
                
                
                
                <li><a href="index.html">Home</a></li>
                
                
                
                <li><a href="faq.html">FAQs</a></li>
                
                
                
                <li><a href="contactus.html">Contact Us</a></li>
                
                
                
                <!-- entries with drop-downs appear here -->
                <!-- conditional logic to control which topnav appears for the audience defined in the configuration file.-->
                
                
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Downloads<b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        
                        
                        <li><a href="https://store.docker.com/plugins/vsphere-docker-volume-service" target="_blank">Docker Plugin</a></li>
                        
                        
                        
                        <li><a href="https://bintray.com/vmware/vDVS/VIB/_latestVersion" target="_blank">VIB</a></li>
                        
                        
                        
                        <li><a href="https://bintray.com/vmware/vDVS/vDVS_RPM/_latestVersion" target="_blank">RPM</a></li>
                        
                        
                        
                        <li><a href="https://bintray.com/vmware/vDVS/vDVS_DEB/_latestVersion" target="_blank">DEB</a></li>
                        
                        
                    </ul>
                </li>
                
                
                
                <!--comment out this block if you want to hide search-->
                <li>
                    <!--start search-->
                    <div id="search-demo-container">
                        <input type="text" id="search-input" placeholder="search...">
                        <ul id="results-container"></ul>
                    </div>
                    <script src="js/jekyll-search.js" type="text/javascript"></script>
                    <script type="text/javascript">
                            SimpleJekyllSearch.init({
                                searchInput: document.getElementById('search-input'),
                                resultsContainer: document.getElementById('results-container'),
                                dataSource: 'search.json',
                                searchResultTemplate: '<li><a href="{url}" title="vFile volume plugin for Docker">{title}</a></li>',
                    noResultsText: 'No results found.',
                            limit: 10,
                            fuzzy: true,
                    })
                    </script>
                    <!--end search-->
                </li>
            </ul>
        </div>
        </div>
        <!-- /.container -->
</nav>

<!-- Page Content -->
<div class="container">
    <div class="col-lg-12">&nbsp;</div>
    <!-- Content Row -->
    <div class="row">
        <!-- Sidebar Column -->
        <div class="col-md-3">

          












<ul id="mysidebar" class="nav">
    <li class="sidebarTitle">Menu </li>
    
    
    
    <li>
        <a href="#">Get Started</a>
        <ul>
            
            
            
            <li><a href="index.html">Introduction</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">Setup</a>
        <ul>
            
            
            
            <li><a href="prerequisite.html">Prerequsites</a></li>
            
            
            
            
            
            
            <li><a href="install.html">Installation</a></li>
            
            
            
            
            
            
            <li><a href="configuration.html">Configuration</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">User Guide</a>
        <ul>
            
            
            
            <li><a href="docker-volume-cli.html">Docker Volume Management</a></li>
            
            
            
            
            
            
            <li><a href="docker-compatibility.html">Docker Compatibility</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">Admin Guide</a>
        <ul>
            
            
            
            <li><a href="datastores.html">Datastores Support</a></li>
            
            
            
            
            
            
            <li><a href="admin-cli.html">Admin CLI Reference</a></li>
            
            
            
            
            
            
            <li><a href="tenancy.html">Multi-tenancy Support</a></li>
            
            
            
            
            
            
            <li><a href="policy-based-management.html">Storage Policy Based Management</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">Applications & Examples</a>
        <ul>
            
            
            
            <li><a href="demo-wordpress-app.html">Wordpress application with MariaDB</a></li>
            
            
            
            
            
            
            <li><a href="demo-ha-swarm.html">HA DB in Docker Swarm mode</a></li>
            
            
            
            
            
            
            <li><a href="docker-service.html">Running MongoDB (Docker Service) with vSphere volume</a></li>
            
            
            
            
            
            
            <li><a href="docker-stacks.html">Running an Example App with Docker Stacks</a></li>
            
            
            
            
            
            
            <li><a href="s3-object-storage.html">S3 Object storage with vDVS</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">Miscellaneous</a>
        <ul>
            
            
            
            <li><a href="photon.html">Photon Platform</a></li>
            
            
            
            
            
            
            <li><a href="blogs.html">Blogs</a></li>
            
            
            
            
            
            
            <li><a href="known-issues.html">Known Issues</a></li>
            
            
            
            
        </ul>
        
        
        
        <!-- if you aren't using the accordion, uncomment this block:
           <p class="external">
               <a href="#" id="collapseAll">Collapse All</a> | <a href="#" id="expandAll">Expand All</a>
           </p>
           -->
    </li>
</ul>
</div>

<!-- this highlights the active parent class in the navgoco sidebar. this is critical so that the parent expands when you're viewing a page. This must appear below the sidebar code above. Otherwise, if placed inside customscripts.js, the script runs before the sidebar code runs and the class never gets inserted.-->
<script>$("li.active").parents('li').toggleClass("active");</script>

    <!-- Content Column -->
    <div class="col-md-9">
        <div class="post-header">
   <h1 class="post-title-main">vFile volume plugin for Docker</h1>
</div>



<div class="post-content">

   

    
    
<!-- this handles the automatic toc. use ## for subheads to auto-generate the on-page minitoc. if you use html tags, you must supply an ID for the heading element in order for it to appear in the minitoc. -->
<script>
$( document ).ready(function() {
  // Handler for .ready() called.

$('#toc').toc({ minimumHeaders: 0, listType: 'ul', showSpeed: 0, headers: 'h2,h3,h4' });

/* this offset helps account for the space taken up by the floating toolbar. */
$('#toc').on('click', 'a', function() {
  var target = $(this.getAttribute('href'))
    , scroll_target = target.offset().top

  $(window).scrollTop(scroll_target - 10);
  return false
})
  
});
</script>

<div id="toc"></div>

    


    

    <a target="_blank" href="https://github.com/vmware/docker-volume-vsphere/edit/gh-pages/jekyll-docs//vfile-plugin.md" class="btn btn-default githubEditButton" role="button"><i class="fa fa-github fa-lg"></i> Edit me</a>

    

  <h2 id="overview">Overview</h2>
<p>Depending on the underlying block storage system, it might not be possible to access the same
persistent volume across different hosts/nodes simultanously.
For example, currently users cannot mount the same persistent volume which is created through
vSphere Docker Volume Service (vDVS) on containers running on two different hosts at the same time.</p>

<p>This can be solved through distributed file systems, such as NFS, Ceph, Gluster, etc.
However, setting up and maintaining enterprise storage offerings for Cloud Native usecases is not a trivial work.
Furthermore, users can face more challenges in order to achieve high availability, scalability, and load balancing.</p>

<p><strong>vFile volume plugin for Docker</strong> provides simultaneous persistent volume access between hosts in the
same Docker Swarm cluster for the base volume plugin service such as vDVS, with zero configuration effort,
along with high availability, scalability, and load balancing support.</p>

<h2 id="detailed-documentation">Detailed documentation</h2>
<p>Detailed documentation can be found on our <a href="http://vmware.github.io/docker-volume-vsphere/documentation/">GitHub Documentation Page</a>.</p>

<h2 id="prerequisites">Prerequisites</h2>
<ul>
  <li>Docker version: 17.06.0 or newer</li>
  <li>Base docker volume plugin: <a href="https://github.com/vmware/docker-volume-vsphere">vSphere Docker Volume Service</a></li>
  <li>All hosts running in <a href="https://docs.docker.com/engine/swarm/swarm-tutorial/">Swarm mode</a></li>
</ul>

<h2 id="installing">Installing</h2>
<p>The recommended way to install vFile plugin is from docker cli:
<code class="highlighter-rouge">
docker plugin install --grant-all-permissions --alias vfile vmware/vfile:latest
</code>
Note: please make sure the base volume plugin is already installed!</p>

<h2 id="usage-examples">Usage examples</h2>

<h4 id="creating-a-persistent-volume-from-vfile-plugin">Creating a persistent volume from vFile plugin</h4>
<div class="highlighter-rouge"><pre class="highlight"><code>$ docker volume create --driver=vfile --name=SharedVol -o size=10gb
$ docker volume ls
$ docker volume inspect SharedVol
</code></pre>
</div>
<p>Options for creation will be the same for the base volume plugin.
Please refer to the base volume plugin for more options.
Note: vFile volume plugin doesn’t support filesystem type options.
Note: The valid volume name can only be <code class="highlighter-rouge">[a-zA-Z0-9][a-zA-Z0-9-]*[a-zA-Z0-9]</code>.</p>

<h4 id="mounting-this-volume-to-a-container-running-on-the-first-host">Mounting this volume to a container running on the first host</h4>
<div class="highlighter-rouge"><pre class="highlight"><code># ssh to node1
$ docker run --rm -it -v SharedVol:/mnt/myvol --name busybox-on-node1 busybox
/ # cd /mnt/myvol
# read/write data into mounted vFile volume
</code></pre>
</div>

<h4 id="mounting-this-volume-to-a-container-running-on-the-second-host">Mounting this volume to a container running on the second host</h4>
<div class="highlighter-rouge"><pre class="highlight"><code># ssh to node2
$ docker run --rm -it -v SharedVol:/mnt/myvol --name busybox-on-node2 busybox
/ # cd /mnt/myvol
# read/write data from mounted vFile volume
</code></pre>
</div>

<h4 id="stopping-the-two-containers-on-each-host">Stopping the two containers on each host</h4>
<div class="highlighter-rouge"><pre class="highlight"><code># docker stop busybox-on-node1
# docker stop busybox-on-node2
</code></pre>
</div>

<h4 id="removing-the-vfile-volume">Removing the vFile volume</h4>
<div class="highlighter-rouge"><pre class="highlight"><code>$ docker volume rm SharedVol
</code></pre>
</div>

<h2 id="configuration">Configuration</h2>
<p>### Options for vFile plugin
Users can choose the base volume plugin for vFile plugin, by setting configuration during install process.
<!---
* Through CLI flag can only be done through non-managed plugin.
---></p>

<ul>
  <li>Default config file location: <code class="highlighter-rouge">/etc/vfile.conf</code>.</li>
  <li>Default base volume plugin: vSphere Docker Volume Service</li>
  <li>Sample config file:
<code class="highlighter-rouge"><span class="w">
</span><span class="p">{</span><span class="w">
      </span><span class="nt">"InternalDriver"</span><span class="p">:</span><span class="w"> </span><span class="s2">"vsphere"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></li>
</ul>

<p>The user can override the default configuration by providing a different configuration file,
via the <code class="highlighter-rouge">--config</code> option, specifying the full path of the file.</p>

<h3 id="options-for-logging">Options for logging</h3>
<ul>
  <li>Default log location: <code class="highlighter-rouge">/var/log/vfile.log</code>.</li>
  <li>Logs retention, size for rotation and log location can be set in the config file too:
<code class="highlighter-rouge"><span class="w">
 </span><span class="p">{</span><span class="w">
  </span><span class="nt">"MaxLogAgeDays"</span><span class="p">:</span><span class="w"> </span><span class="mi">28</span><span class="p">,</span><span class="w">
  </span><span class="nt">"MaxLogSizeMb"</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w">
  </span><span class="nt">"LogPath"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/var/log/vfile.log"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></li>
</ul>

<h2 id="qa">Q&amp;A</h2>

<h3 id="how-to-install-and-use-the-driver">How to install and use the driver?</h3>
<p>Please see README.md in the for the release by clicking on the tag for the release. Example: TBD.</p>

<h3 id="can-i-use-another-base-volume-plugin-other-than-vdvs">Can I use another base volume plugin other than vDVS?</h3>
<p>Currently vFile volume service is only developed and tested with vDVS as the base volume plugin.</p>

<h3 id="i-got-operation-now-in-progress-error-when-mounting-a-vfile-volume-to-a-container">I got “Operation now in progress” error when mounting a vFile volume to a container.</h3>
<p>Please make sure the routing mesh of Docker Swarm cluster is working properly.
Use the following way to verify:
<code class="highlighter-rouge">
docker service create --replicas 1 -p 8080:80 --name web nginx
</code>
Then on each host, make sure there is valid return of <code class="highlighter-rouge">curl 127.0.0.1:8080</code>.
<code class="highlighter-rouge">Connection refused</code> error means the routing mesh of this Docker Swarm cluster is broken and needs to be fixed.</p>

<h3 id="mounting-volume-failed-and-i-saw-name-must-be-valid-as-a-dns-name-component-error-in-the-log-when-mounting-a-vfile-volume-to-a-container">Mounting volume failed and I saw “name must be valid as a DNS name component” error in the log when mounting a vFile volume to a container.</h3>
<p>When you see somthing like the following in the log
<code class="highlighter-rouge">
2017-08-24 11:57:16.436786459 -0700 PDT [WARNING] Failed to create file server for volume space vol7. Reason: Error response from daemon: {"message":"rpc error: code = 3 desc = name must be valid as a DNS name component"}
</code>
Please make sure the volume you used is a valid volume name. A valid volume name consists of <code class="highlighter-rouge">[a-zA-Z0-9][a-zA-Z0-9-]*[a-zA-Z0-9]</code>.</p>

<h3 id="i-got--volumedrivermount-failed-to-blocking-wait-for-mounted-state-error-timeout-reached-blockingwait-is-not-complete-when-mounting-a-volume">I got “ VolumeDriver.Mount: Failed to blocking wait for Mounted state. Error: Timeout reached; BlockingWait is not complete..” when mounting a volume.</h3>
<p>We see this issue only on platform where the space is low. When available disk space are low, Docker Swarm service may take longer to start a service. Generally it’s better free up some disk space. You can also try to increase the service start timeout value, controlled by <code class="highlighter-rouge">VFILE_TIMEOUT_IN_SECOND</code> env variable:
<code class="highlighter-rouge">
docker plugin install --grant-all-permissions --alias vfile vmware/vfile:latest VFILE_TIMEOUT_IN_SECOND=90
</code>
This will increase timeout to 90 sec, from default of 30 sec.</p>

<h3 id="i-got-docker-volume-ls-operation-very-slow-and-docker-volume-rmcreate-a-vfile-volume-hang-forever">I got “docker volume ls” operation very slow and “docker volume rm/create” a vFile volume hang forever</h3>
<p>Please check the log at <code class="highlighter-rouge">/var/log/vfile.log</code> and look up if there are error message about swarm status as follow:
<code class="highlighter-rouge">The swarm does not have a leader. It's possible that too few managers are online. Make sure more than half of the managers are online.</code></p>

<p>This error message indicates the swarm cluster is not in a healthy status.</p>

<p>Please follow the following <a href="https://docs.docker.com/engine/swarm/how-swarm-mode-works/nodes/#manager-nodes">recommendations for the Swarm manager nodes setup</a>:
    1. Run the swarm cluster with a single manager only for testing purpose.
    2. An <code class="highlighter-rouge">N</code> manager cluster will tolerate the loss of at most <code class="highlighter-rouge">(N-1)/2</code> managers.
    3. Docker recommends a maximum of seven manager nodes for a swarm.</p>


  

    <div class="tags">
        
    </div>

    

</div>

<hr class="shaded"/>

<footer>
            <div class="row">
                <div class="col-lg-12 footer">
               &copy;2017 VMWare. All rights reserved. <br />
 Site last generated: Aug 28, 2017 <br />
<p><img src="images/company_logo.png" alt="Company logo"/></p>
                </div>
            </div>
</footer>


    </div>
    <!-- /.row -->
</div>
<!-- /.container -->
    </div>

</body>

</html>